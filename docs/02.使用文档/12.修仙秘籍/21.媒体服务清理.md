---
title: 媒体服务清理
article: false
tags: 
  - 修仙秘籍
  - 媒体服务
  - 清理
categories: 
editor: markdown
permalink: /docs/cultivation_secrets/media_server_clean/
date: 2023-09-27 12:16:17
---

# 📹 媒体服务清理

**媒体服务清理** 是一个用于自动清理媒体服务器中大文件的插件，专门针对电影类型，可以按照文件大小阈值自动清理超大的媒体文件，释放存储空间。

## ⚙️ 功能特点

### 🧹 大文件清理
- **Emby支持**：目前仅支持Emby媒体服务器
- **电影清理**：专门清理电影类型的大文件
- **体积控制**：按设定的GB阈值清理超大文件
- **定时执行**：支持定时自动清理

### 🎯 适用场景
- **存储空间紧张**：自动清理超大电影文件释放空间
- **质量管理**：移除过大的低效率编码文件
- **自动维护**：定期清理维持媒体库整洁

## 🚀 配置指南

### 📋 配置参数

插件提供以下配置选项：

### ⚙️ 基础设置

1. **周期 (cron)**：
   - 设置定时清理的执行周期
   - 使用Cron表达式格式
   - 示例：`30 8 * * *` 每天上午8:30执行
   - 可留空仅使用手动清理

2. **媒体库 (mediaServerId)**：
   - 选择要清理的媒体服务器
   - **重要**：目前仅支持Emby
   - 从已配置的媒体服务器列表中选择

3. **最大体积(GB) (maxSize)**：
   - 设置文件大小阈值
   - 超过此大小的媒体文件将被清理
   - **仅适用于电影类型**
   - 示例：设置20表示清理超过20GB的电影文件

### 🔧 操作功能

4. **运行一次**：
   - 手动触发一次清理操作
   - 立即执行清理任务
   - 不受定时任务设置影响

## 📖 使用说明

### 清理范围

#### 支持的媒体服务器
- **Emby**：完全支持
- **其他服务器**：暂不支持

#### 清理类型
- **电影文件**：仅清理电影类型的媒体文件
- **剧集文件**：暂不支持清理剧集

#### 文件大小判断
- 按单个媒体文件的实际大小计算
- 以GB为单位设置阈值
- 超过阈值的文件将被清理

### 定时任务配置

#### Cron表达式示例

```bash
# 每天凌晨3点清理
0 3 * * *

# 每周日上午8点清理
0 8 * * 0

# 每月1日凌晨2点清理
0 2 1 * *

# 每周三和周六上午10点清理
0 10 * * 3,6
```

> 📖 **详细说明**：关于Cron表达式的完整语法和更多示例，请参考：[Cron表达式说明文档](/docs/other/cron_rule)

### 使用步骤

#### 配置流程

1. **选择媒体库**：
   - 从下拉列表选择Emby服务器
   - 确保媒体库连接正常

2. **设置大小阈值**：
   - 根据存储情况设置合理的GB阈值
   - 建议先设置较大的值测试效果

3. **配置定时任务**：
   - 设置合适的清理周期
   - 避免在高峰时段执行

4. **测试运行**：
   - 先使用"运行一次"功能测试
   - 确认清理效果后再启用定时任务

#### 清理过程

1. **文件扫描**：
   - 扫描Emby媒体库中的电影文件
   - 获取每个文件的实际大小

2. **大小比较**：
   - 将文件大小与设定阈值比较
   - 标记超过阈值的文件

3. **执行清理**：
   - 删除标记的超大文件
   - 更新媒体库索引

## ⚠️ 注意事项

### 重要警告

1. **功能限制**：
   - **仅支持Emby媒体服务器**
   - **仅清理电影类型文件**
   - 不支持其他媒体服务器或剧集文件

2. **数据风险**：
   - **清理操作不可恢复**
   - 被清理的文件将被永久删除
   - 请确保有重要文件的备份

3. **阈值设置**：
   - 合理设置文件大小阈值
   - 避免误删重要的高质量文件
   - 建议从较大的值开始逐步调整

### 使用建议

1. **测试先行**：
   - 首次使用先手动测试
   - 从较大的阈值开始设置
   - 观察清理结果后再调整

2. **定期检查**：
   - 定期检查清理日志
   - 确认清理的文件符合预期
   - 及时调整清理策略

3. **备份重要文件**：
   - 对重要的媒体文件做好备份
   - 设置合理的清理阈值避免误删
   - 考虑使用回收站功能

### 故障排除

1. **清理无效果**：
   - 检查媒体库连接状态
   - 确认文件大小阈值设置
   - 验证权限配置是否正确

2. **清理失败**：
   - 检查Emby服务器状态
   - 确认文件访问权限
   - 查看系统日志获取详细错误

3. **误删文件**：
   - 检查回收站是否有文件
   - 从备份中恢复重要文件
   - 调整阈值避免类似问题

## 📊 使用效果

### 清理统计
- **已清理文件数量**：清理的电影文件数量
- **释放空间大小**：总共释放的存储空间
- **最后清理时间**：最近一次清理的执行时间
- **平均文件大小**：被清理文件的平均大小

### 存储优化
- **空间释放**：有效释放存储空间
- **库整理**：保持媒体库文件大小合理
- **性能提升**：减少大文件对系统性能的影响

## 🔗 相关链接

- [修仙秘籍主页](/docs/cultivation_secrets/main/)
- [Cron表达式说明](/docs/other/cron_rule)

---

🎯 **提示**：此功能仅支持Emby媒体服务器清理电影文件，清理操作不可恢复，请谨慎设置文件大小阈值。

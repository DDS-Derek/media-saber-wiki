---
title: 基础设置
article: false
tags: null
categories: null
editor: markdown
permalink: /docs/system_settings/basic_settings/
date: 2023-09-27 12:16:17
---

## 1、系统

### Web 管理用户密码

- 默认用户为`admin`，默认密码为：`password`
  > 首次登录后务必按提示修改管理用户密码，使用默认密码同时暴露地址到公网可能造成入侵及信息泄露风险！

### 代理服务器

- 将使用代理访服务器访问`themoviedb`、`telegram`等境外网站及程序更新(git)，站点默认不使用代理，如需使用需在站点维护中开启.
- 配置格式示例：`127.0.0.1:7890`（Http 协议）、`socks5://127.0.0.1:8018`、`socks5h://127.0.0.1:8018`(remote DNS)。
- 代理中使用用户认证：` socks5://user:password@127.0.0.1:7891`

### 外网访问地址

- 使用该地址进行`通知点击跳转`以及设置 Telegram 机器人 Webhook。
- 需要配置 IP 地址和端口，如为 https 则需要加`https://`前缀。
- 如启用 Telegram 机器人 Webhook，则端口必须为：`443`, `80`, `88`, `8443`之一，80、443 一般运营商会封禁，建议使用`88`、`8443`。

### User-Agent

- 系统全局网络请求时默认使用的 User-Agent，未在`站点维护`中维护站点的 User-Agent 时将默认使用。
- 如发现被豆瓣、PT 站等封堵，可修改此项。

### 静态资源缓存(重启后生效)

- 静态资源缓存时间，设置静态资源缓存有利于提高浏览器加载速度，修改后需要`重启容器`生效 静态文件的缓存时间，单位为秒 默认为 43200 秒，即 12 小时。
- 设置为 0 或者空则不缓存
- 如果出现显示异常，请清空浏览器缓存或者关闭静态资源缓存并重启
- 该设置 `重启后生效`

### 自定义 CSS/Javascript

- 通过`自定义CSS`，所以用 Media Saber 的 UI 风格进行修改。
- 通过`自定义Javascip`t，所以在打开 WEB 页面时执行动作，以及辅助 CSS 修改页面风格。

## 2、媒体

### TMDB API Key

- 在`www.themoviedb.org`网站申请 API Key，教程：[申请 API](/guide/init/setting/_1、申请TMDB API)。

- 该项必须配置，否则所有功能无法正常运行.

### TMDB API Url

- 选择访问 TMDB API 时使用的地址，`api.themoviedb.org`、`api.tmdb.org`为官方地址，其余为使用代理中转，如无法连接 TMDB 匹配媒体信息时可尝试更换。

### TMDB 匹配模式

- **正常模式**：会提升文件命名不规范的资源（未标识年份、是否剧集等）识别成功率，但也可能会导致误识别率增加。
- **严格模式**：可以降低误识别率，但可能导致很多文件名/种子名中年份/剧集信息不正确的无法被识别（特别是剧集，需要是首播年份）。

### 二级分类策略

- 启用二级分类后会在电影/电视剧/动漫媒体库目录下按二级分类名建立子目录。
- 此处配置分类的策略名，保存后会自动生成默认配置，配置可修改。
- 如不需要启动分类，则该项配置为`空`。
- 点击[查看默认二级分类配置](/docs/setting/secondary_class/)。

### TMDB 图片代理

- 加速 TMDB 图片下载，留空使用 TMDB 官方地址。
- TMDB 媒体图片无法显示，可参考使用：[TMDB 图片代理](/docs/other/common_source/)。

### OpenAI API

- 自定义 openai 请求地址（请注意格式，请求地址需带有请求头且最后没有/号）。
- 不填默认使用`https://api.openai.com`。
- 支持`https://openai.api2d.net`。

> 注意：填写了该项后，则消息交互默认会触发 ChatGPT 问答，如需搜索资源，需在发送的名称前添加`订阅/搜索/下载`前缀。

### 下载优先规则

- 订阅及远程搜索下载将按此优先规则选择下载资源，但不管选择哪一种，都低于`过滤规则`命中的优先级。
- **站点优先**：优先选择优先级较高的站点的资源进行下载。
- **做种数优先**：优先选择做种数最多的资源进行下载。

> **站点优先时的排序规则**：`过滤规则` -> `站点` -> `做种数` -> `季数` -> `集数`。
> **做种数优先时的排序规则**：`过滤规则` -> `做种数` -> `站点` -> `季数` -> `集数`。

### 搜索默认规则

- 用于快捷搜索时的默认规则，优先级最高。

### 硬连接后触发变化

- 用于部分设备出现硬连接后文件不刷新的情况，比如极空间。其他设备无问题不建议开启，避免影响性能。

### 文传转移忽略

- **转移最小文件大小**：`小于`该大小的文件将会忽略，不进行转移重命名。
- **文件路径转移忽略词**：`文件路径`包含忽略词的，忽略转移，支持正则表达式，特殊字符需要`\`转义。
- **文件名转移忽略词**：`文件名`（包括扩展名）包含忽略词的，忽略转移，支持正则表达式，特殊字符需要`\`转义。

### 重命名格式

- 程序会按定义的命名格式对电影/电视剧进行重命名。
- `/`代表上下级目录，电影只支持两层：`目录名/文件名`，电视剧只支持三层：`目录名/季名/文件名`。
- `{}`内为占位符，转义为`{{}}`，占位符会使用文件识别出来的实际值替换；占位符外的字符会当成普通字符，直接体现在名称上。
- `占位符`字典参考：[电影占位符](/docs/other/glossary/#电影占位符)、[电视剧占位符](/docs/other/glossary/#电视剧占位符)。

### 刮削设置

- 打开`刮削元数据及图片`代表开始自动刮削，文件转移完成后会自动生成 nfo 元数据及图片文件保存在媒体相应目录。
- `刮削设置`可详细设置刮削内容，其中`演职人员中文`需要频繁访问豆瓣，且 Emby 不支持自动显示演员头像，`建议关闭`。
- TMDB 无缩略图时，支持通过`ffmpeg`读取文件生成缩略图。

### 高质量文件覆盖

- 可通过在重命名格式中添加`版本`、`分辨率`、`视频编码`等占位符，实现重复下载同一电影/电视剧时保留多个版本文件。
- 文件转移时如按重命名格式发现文件已存在，打开此开关会使用`更大体积`的文件覆盖，否则不处理。

## 3、服务

### 订阅 RSS 周期

- 坊取`站点RSS地址`以匹配订阅的时间间隔，需要在订阅管理中设置订阅站点。
- 配置为`空`则不启动 RSS 订阅功能。
- 为了减小站点压力，最小周期不能小于`300秒`。

### 订阅搜索周期

- 定时对电影/电视剧订阅进行`站点存量资源检索`的时间间隔，用于对 RSS 订阅进行查漏补缺。
- `留空`关闭订阅定时搜索。
- 以`小时`为单位，最小间隔为`6小时`，设置小于 6 小时时将强制设定为 6 小时。
- **该项会对站点造成压力**，使用搜索功能来订阅不是常规手段，应尽量通过`维护站点RSS地址`实现订阅追新，如非必要请不要开启。

### 媒体库同步周期

- 定时同步媒体服务器数据到本地，用于展示媒体是否存在。表现为：媒体卡片右上角`绿色图标`、媒体详情显示`已入库`标签。
- `留空`关闭媒体库同步。

### 站点数据刷新周期

- `站点数据`自动刷新的时间周期。

**四种配置方法：**

- 配置间隔，单位`小时`，比如`23.5`。
- 配置固定时间，如`08:00`。
- 配置时间范围，如`08:00-09:00`，表示在该时间范围内随机执行一次。
- 配置 5 位 cron 表达式，如：`0 */6 * * *`，cron 表达式规则参考：[cron 表达式](/docs/other/cron_rule)。
- 配置为`空`则不启用自动站点数据刷新功能。

### 远程自动择优下载

- 启用后在微信、Telegram 等发送名称后会按配置的下载优先规则及过滤规则自动择优下载。
- 否则需要点击链接跳转后手工选择，关闭后需要先维护好`外网访问地址`，否则无法点击跳转。

### 不完整自动添加订阅

- 启用后在微信、Telegram 发送名称搜索下载不完整时将自动添加订阅。

## 4、安全

### 源地址

- 仅接收配置的地址范围内发送 Webhook 及消息请求，避免对外暴露的接口被恶意使用。
- 多个地址段用`,`号分隔，配置为`0.0.0.0/0`,`::/0`则不做限制。
- 使用 Telegram WebHook 且未做代理转发时推荐 Telegram IPv4 地址设置为：`149.154.160.0/20,91.108.4.0/22`，关闭 Telegram WebHook 时推荐 Telegram IPv4 地址设置为：`127.0.0.1`。

### API 密钥

- 使用 Jellyseerr、Overseerr 等调用本程序订阅接口时，需要在 Authorization 中填入该密钥。
- API 中`GET`类接口需要使用此 API 密钥调用。

### 验证外部请求的 API 密钥

- 启用后，需要在原来的 Media Saber API 地址后面拼接 `?apikey=xxx` ，xxx 为 API 密钥，例如 Emby 回调接口由原来的 `http://nastool:3000/emby` 改为 `http://nastool:3000/emby?apikey=xxx`。
- 受影响的接口有：`plex`、`jellyfin`、`emby`、`telegram`、`synology`、`slack`、`ical`。
- 所有对外服务接口参考：[对外服务地址](/docs/other/glossary/#对外服务地址)。

## 5、OCR 识别

### OCR 服务地址

- OCR 服务地址，用于网站登录更新 cookie 以及特殊站点签到等识别验证码场景。可根据需要需要自行修改
- 详见文档：[OCR 服务](/docs/system_settings/ocr_service/)

## 6、实验室

### 辅助识别

- 开启后，无法识别到媒体信息时会尝试猜测和纠正关键词并再次匹配。
- 会大大增加识别耗时，一般情况下不建议开启。

### WEB 增强识别

- 开启后，通过 TMDB 的 API 无法识别到媒体信息时，会尝试通过`www.themoviedb.org`网站再次搜索匹配。
- 仅个别极端情况下有效，会大大增加识别耗时，一般情况下不建议开启

### ChatGPT 增强识别

- 开启后，通过 TMDB 的 API 无法识别到媒体信息时，使用`ChatGPT`识别匹配，需要先填写 OpenAI API Key。
- 效果较好，但是涉及 API 收费。

### TMDB 缓存过期策略

- 开启 TMDB 缓存过期策略后，默认`7天`过期，过期缓存将被删除, 7 天内访问过期时间可以被刷新。
- 建议开启，缓存过多记录会造成使用内存量增加。

### 默认搜索豆瓣资源

- 开启将使用`豆瓣`进行电影电视剧的名称搜索，允许中文名不完整时自动联想，但如豆瓣数据与 TMDB 不一致时可能会无法搜索.
- 关闭后使用`TMDB`的数据进行名称搜索，对中文支持没有豆瓣友好，但不会有无法搜索的问题。

### 优先使用英文名

- 开启后对于精确搜索场景将会优先使用`英文名`（从 TMDB 数据中获取）搜索，否则优先使用`中文名`搜索。
- 不管是否打开此项，第一次搜索名称没有资源时，都会自动使用另一个名称再次搜索。

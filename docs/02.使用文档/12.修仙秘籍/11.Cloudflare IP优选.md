---
title: Cloudflare IP优选
article: false
tags: 
  - 修仙秘籍
  - Cloudflare
  - IP优选
  - 网络优化
categories: 
editor: markdown
permalink: /docs/cultivation_secrets/cloudflare_ip_optimization/
date: 2023-09-27 12:16:17
---

# 🌩️ Cloudflare IP优选

**Cloudflare IP优选** 是一个用于测试Cloudflare CDN延迟和速度，自动优选最快IP的插件。通过定期测试，为指定域名选择最优的Cloudflare节点IP，提升网络访问速度。

## ⚙️ 功能特点

### 🚀 智能优选
- **延迟测试**：测试Cloudflare CDN节点的网络延迟
- **速度测试**：测试下载速度选择最快节点
- **自动优选**：根据测试结果自动选择最优IP
- **Hosts更新**：自动更新系统Hosts文件

### 🌐 网络优化
- **CDN加速**：为网站选择最优CDN节点
- **访问提速**：显著提升Cloudflare网站访问速度
- **智能切换**：根据网络状况动态调整IP
- **IPv6支持**：支持IPv4和IPv6双栈优选

## 🚀 配置指南

### 基础配置

1. **优选域名设置**：
   - 在"优选域名"框中输入需要优选的域名
   - 每行一个域名，支持多个域名
   - 域名前后不能有空格

2. **定时任务设置**：
   ```
   0 6 * * *     # 每天早上6点优选
   0 */12 * * *  # 每12小时优选一次
   0 3 * * 0     # 每周日凌晨3点优选
   ```

3. **优选参数**：
   - **IPv6模式**：开启后优选IPv6地址
   - **重装选项**：每次重新下载CloudflareSpeedTest工具
   - **运行通知**：开启后发送优选结果通知

### 高级配置

1. **高级参数设置**：
   - **-dd参数**：不测试下载速度，只测试延迟
   - **-t 1参数**：只测试一遍
   - **-n 200参数**：测试200个IP
   - **-tl 300参数**：延迟超时300毫秒

2. **域名配置要求**：
   - 域名必须使用Cloudflare CDN
   - 需要与Hosts配置一致
   - 确保域名格式正确

## 📖 使用说明

### 优选流程

1. **工具准备**：
   - 下载CloudflareSpeedTest工具
   - 检查工具版本和兼容性
   - 准备测试参数

2. **IP测试**：
   - 获取Cloudflare IP段
   - 批量测试IP延迟和速度
   - 筛选出最优IP列表

3. **结果应用**：
   - 更新系统Hosts文件
   - 应用最优IP配置
   - 发送优选结果通知

### 域名配置示例

**正确格式**：
```
example.com
cdn.example.com
api.example.com
static.example.com
```

**注意事项**：
- 每行一个域名
- 域名前后不要有空格
- 不要包含协议前缀（http://、https://）
- 确保域名使用Cloudflare CDN

### 定时任务配置

合理设置优选频率：

> 📖 **详细说明**：关于Cron表达式的完整语法和更多示例，请参考：[Cron表达式说明文档](/docs/other/cron_rule)

**推荐频率**：
- **每日优选**：`0 6 * * *` - 每天早上6点
- **高频优选**：`0 */12 * * *` - 每12小时
- **每周优选**：`0 3 * * 0` - 每周日凌晨3点

### 手动操作

**运行一次**：
- 点击配置页面的"运行一次"按钮
- 手动触发一次IP优选操作
- 查看优选结果和应用效果

## ⚙️ 配置参数

### 优选设置

1. **优选周期**：
   - 使用Cron表达式设置定时优选
   - 支持5位cron表达式格式
   - 参考：https://tool.lu/crontab/

2. **优选域名**：
   - 多行文本输入框
   - 每行一个域名
   - 必须与Hosts配置一致

3. **网络模式**：
   - **IPv4模式**：优选IPv4地址（默认）
   - **IPv6模式**：优选IPv6地址（测速时间较长）

### 高级选项

1. **高级参数**：
   - 传递给CloudflareSpeedTest的额外参数
   - 常用参数：-dd（不测下载）、-t 1（测试一次）
   - 非特殊需求可不填

2. **重装设置**：
   - **每次重装**：重新下载最新版本工具
   - **使用缓存**：使用已下载的工具（推荐）

3. **通知设置**：
   - **运行通知**：优选完成后发送通知
   - **错误通知**：优选失败时发送警告

## ⚠️ 注意事项

### 使用要求

1. **域名要求**：
   - 域名必须接入Cloudflare CDN
   - 确保域名可以正常解析
   - 域名格式必须正确

2. **网络环境**：
   - 确保网络连接稳定
   - 避免在网络高峰期测试
   - 考虑代理和防火墙影响

3. **系统权限**：
   - 需要修改Hosts文件的权限
   - 确保有足够的磁盘空间
   - 检查系统防病毒软件设置

### 性能考虑

1. **测试时间**：
   - IPv4测试通常需要5-10分钟
   - IPv6测试时间会更长
   - 避免频繁测试影响网络

2. **系统资源**：
   - 测试过程会占用一定CPU和网络
   - 建议在系统空闲时执行
   - 监控系统资源使用情况

### 故障排除

1. **优选失败**：
   - 检查网络连接状态
   - 确认域名配置正确
   - 查看详细错误日志

2. **工具下载失败**：
   - 检查网络连接
   - 尝试手动下载工具
   - 关闭"每次重装"选项

3. **Hosts更新失败**：
   - 检查文件权限
   - 确认Hosts文件路径
   - 验证系统安全软件设置

## 📊 优选结果

### 测试报告
- **最优IP**：延迟最低的IP地址
- **平均延迟**：所有测试IP的平均延迟
- **速度结果**：下载速度测试结果
- **更新状态**：Hosts文件更新状态

### 效果评估
- **访问速度提升**：优选前后速度对比
- **延迟降低幅度**：网络延迟改善情况
- **稳定性评估**：IP连接稳定性分析

## 🔗 相关链接

- [修仙秘籍主页](/docs/cultivation_secrets/main/)
- [Cron表达式说明](/docs/other/cron_rule)
- [自定义Hosts](/docs/cultivation_secrets/custom_hosts/)
- [小米路由Hosts](/docs/cultivation_secrets/mi_hosts/)

---

🎯 **提示**：Cloudflare IP优选可以显著提升网站访问速度，建议定期运行以保持最佳效果。